# Генератор задач
**Генератор задач** представляет собой desktop-приложение, позволяющее генерировать большое количество шаблонизированных задач с решениями. Для запуска генерации необходимо указать путь к *файлу конфигурации*, желаемое количество задач и путь к файлу, в который записать результат генерации.
# Файл конфигурации

## Синтаксис
Поддерживаются файлы конфигурации двух видов:
### Объявление одной задачи:
```json
{
  "data": [
    ...
  ],
  "conditions": [
    ...
  ],
  "solution": [
    ...
  ]
}
```
При объявлении задачи обязательным является только массив `"data"`. Генерация может успешно завершиться без `"conditions"` (полученные результаты будут соответствовать задающим их регулярным выражениям и не будут проверяться на дополнительные условия) и `"solution"` (файл с решением не будет создан).

Подробнее о допустимом содержимом указанных выше массивов:
  - `"data"` может содержать объекты типов:

  1. `"text"`
```json
{
  "type": "text",
  "value": "Произвольная строка"
}
```
Произвольная строка может быть заменена на любой желаемый текст, генератор вставит её без изменений.

  2. `"regex"` 
```json
{
  "type": "regex",
  "value": "Поддерживаемое регулярное выражение",
  "name": "Произвольная строка"
}
```
Реализованный парсер регулярных выражений поддерживает следующие операции:
- Экранирование с помощью `\`.\
*Замечание*: JSON считает символ `\` экранирующим, поэтому для его объявления необходимо писать `\\`.\
Например, `\\\\` задаст один символ `\` в итоговой строке, `\\?` задаст символ `?` и т.д.
- Объявление символьного класса `[]`.\
Например, `[1-4]` задаёт символы `1`, `2`, `3`, `4`.
- Повторение последнего символа с указанием их количества `{}`.\
Например, `[1-5]{3}` эквивалентно регулярному выражению `[1-5][1-5][1-5]`. Допускается запись `5{0-2}`, которая может породить пустую строку, `5` или `55`
- Операция `?`.\
Является сокращённой записью операции `{0-1}`, то есть символ, стоящий перед ней, может быть превращён в пустую строку или оставлен без изменений.

В атрибут `"name"` указывается произвольная строка, по которой в дальнейшем можно будет получить порождённую именно этим регулярным выражением строку (применяется в проверке условий и генерации решений).

- `"conditions"` может содержать условия различных типов, например:
```json
{
  "type": "form_plane",
  "names": [
    "name1", "name2", "name3",
    "name4", "name5", "name6",
    "name7", "name8", "name9"
  ]
}
```
В массиве `"names"` указаны имена `"regex"` объектов из массива `"data"`, каждый такой объект должен порождать строку, которую можно привести в число (возможно вещественное). Генератор соберёт из этих девяти чисел три точки с координатами: `("name1", "name2", "name3")`, `("name4", "name5", "name6")`, `("name7", "name8", "name9")`, проверит, что эти три точки образуют плоскость.
- `"solutions"` содержит в себе объекты типов:
1. `"text"`
Идентичен такому же объекту в массиве `"data"`
2. `"var"`
```json
{
  "type": "var",
  "value": "name"
}
```
В атрибуте `"value"` необходимо написать имя `"regex"` объекта из массива `"data"`, значение которого нужно подставить в файл с решением.

### Объявление множества задач
```json
{
  "tasks": [
    {
      "data": [
        ...
      ],
      "conditions": [
        ...
      ],
      "solution": [
        ...
      ],
      "probability": ...
    },
    {
      "data": [
        ...
      ],
      "conditions": [
        ...
      ],
      "solution": [
        ...
      ],
      "probability": ...
    }
  ]
}
```
Каждый объект в `"tasks"` представляет собой объявление одной задачи и вероятности её выбора в атрибуте `"probability"`. 

## Пример с объявлением одной задачи

```json
{
  "data": [
    {
      "type": "text",
      "value": "Какой-то неизменяемый текст. Даны два числа от 0 до 999: "
    },
    {
      "type": "regex",
      "value": "[1-9]{0-2}[0-9]",
      "name": "first"
    },
    {
      "type": "text",
      "value": " и "
    },
    {
      "type": "regex",
      "value": "[1-9]{0-2}[0-9]",
      "name": "second"
    },
    {
      "type": "text",
      "value": ".\nЗадача: посчитать, насколько второе число больше первого."
    }
  ],
  "conditions": [
    {
      "type": "less",
      "names": [
        "first", "second"
      ]
    }
  ],
  "solution": [
    {
      "type": "text",
      "value": "first_number = "
    },
    {
      "type": "var",
      "value": "first"
    },
    {
      "type": "text",
      "value": "\nsecond_number = "
    },
    {
      "type": "var",
      "value": "second"
    },
    {
      "type": "text",
      "value": "\nprint(f'Второе число больше первого на {second_number - first_number}')"
    }
  ]
}
```
## Пример с объявлением нескольких задач
```json
{
  "tasks": [
    {
      "data": [
        {
          "type": "text",
          "value": "Первая задача"
        }
      ]
    },
    {
      "data": [
        {
          "type": "text",
          "value": "Вторая задача (встречается реже)"
        }
      ],
      "probability": 0.1
    }
  ]
}
```
Пользователь может не указывать вероятность выбора задачи явно (в примере выше не указана вероянтость выбора первой задачи), в таком случае все задачи с неуказанной вероятностью выбора получают значение вероятности по умолчанию.

Вероятность по умолчанию подбирается исходя из двух соображений:
1. Равновероятный выбора задач с неуказанным атрибутом `"probability"`
2. Сохранение справедливости указанных явно вероятностей.

На основе этих соображений была составлена формула для вычисления вероятности по умолчанию:
$$ P_{default} = \frac{1 - \sum\limits_{i = 1}^{n_{1}} p_i}{n - n_1} $$   
В этой формуле:
$$ \begin{aligned}
& n_1 - \text{количество вероятностей, указанных пользователем}\\
& p - \text{массив указанных пользователем вероятностей}\\
& p_i - \text{$i$-й элемент массива $p$}\\
& n - \text{количетсво задач, указанных в "tasks"}
\end{aligned} $$
Воспользуемся этой формулой для нашего примера:
$$
\begin{aligned}
& n_1 = 1,\ \text{так как указана только вероятность выбора второй задачи}\\
& p = (0.1),\ \text{массив из одного элемента, равного "probability" второй задачи}\\
& n = 2,\ \text{так как в конфигурации объявлены две задачи}
\end{aligned}
$$
Подставим в формулу:
$$
P_{default} = \frac{1 - 0.1}{2 - 1} = \frac{0.9}{1} = 0.9
$$
Стоит отметить, что в данной формуле теоретически возможно деление на $0$ в случае $n = n_1$. Однако выполнение этого равенства означает, что пользователь самостоятельно указал вероятность у каждой задачи в массиве `"tasks"`, а значит считать вероятность по умолчанию в таком случае не нужно, то есть на практике деления на ноль происходить не будет.


